# HoYoMusic MVP å¼€å‘æŒ‡å— ğŸµ

## é¡¹ç›®å·²å®Œæˆçš„åŠŸèƒ½

âœ… **åç«¯ (Backend)**
- Express + TypeScript æœåŠ¡å™¨
- PostgreSQL æ•°æ®åº“é…ç½®
- JWT èº«ä»½è®¤è¯
- FLAC æ–‡ä»¶ä¸Šä¼ ï¼ˆæ‰¹é‡æ”¯æŒï¼‰
- éŸ³é¢‘å…ƒæ•°æ®è‡ªåŠ¨æå–
- éŸ³ä¹æµå¼æ’­æ”¾ï¼ˆæ”¯æŒ HTTP Range Requestsï¼‰
- å•æ›²ä¸‹è½½
- RESTful API è®¾è®¡

âœ… **å‰ç«¯ (Frontend)**
- React + TypeScript + Vite
- Ant Design UI ç»„ä»¶
- Zustand çŠ¶æ€ç®¡ç†
- Howler.js éŸ³é¢‘æ’­æ”¾
- ç”¨æˆ·ç™»å½•ç•Œé¢
- éŸ³ä¹åˆ—è¡¨å±•ç¤º
- æŒä¹…åŒ–åº•éƒ¨æ’­æ”¾å™¨
- éŸ³ä¹ä¸Šä¼ åŠŸèƒ½

## ç«‹å³å¼€å§‹ä½¿ç”¨

### å‰ç½®æ¡ä»¶

1. **å®‰è£… PostgreSQL**
   - ä¸‹è½½: https://www.postgresql.org/download/windows/
   - å®‰è£…æ—¶è®°ä½è®¾ç½®çš„ postgres ç”¨æˆ·å¯†ç 

2. **Node.js å·²å®‰è£…**ï¼ˆæ‚¨å·²ç»å®Œæˆï¼‰

### ç¬¬ä¸€æ­¥ï¼šè®¾ç½® PostgreSQL æ•°æ®åº“

æ‰“å¼€ PowerShell æˆ– CMDï¼Œæ‰§è¡Œï¼š

```powershell
# è¿æ¥åˆ° PostgreSQL
psql -U postgres

# åœ¨ psql ä¸­æ‰§è¡Œï¼ˆè¾“å…¥å¯†ç åï¼‰
CREATE DATABASE hoyomusic;
\q
```

### ç¬¬äºŒæ­¥ï¼šé…ç½®åç«¯ç¯å¢ƒå˜é‡

åç«¯çš„ `.env` æ–‡ä»¶å·²ç»åˆ›å»ºå¥½äº†ï¼Œä½äº `backend/.env`ã€‚

**é‡è¦**ï¼šè¯·ä¿®æ”¹æ•°æ®åº“å¯†ç ä¸ºæ‚¨ PostgreSQL çš„å®é™…å¯†ç ï¼š

```env
DB_PASSWORD=ä½ çš„PostgreSQLå¯†ç 
```

### ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“å¹¶å¯åŠ¨åç«¯

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯çª—å£ï¼š

**ç»ˆç«¯ 1 - åç«¯ï¼š**

```powershell
cd backend
npm run setup    # åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„å’Œç®¡ç†å‘˜è´¦æˆ·
npm run dev      # å¯åŠ¨åç«¯æœåŠ¡å™¨
```

åˆå§‹åŒ–æˆåŠŸåï¼Œæ‚¨ä¼šçœ‹åˆ°ï¼š
```
âœ… Database setup complete!
ğŸ“ Admin credentials:
   Username: admin
   Password: admin123
```

åç«¯æœåŠ¡å™¨å°†åœ¨ http://localhost:3000 è¿è¡Œ

### ç¬¬å››æ­¥ï¼šå¯åŠ¨å‰ç«¯

**ç»ˆç«¯ 2 - å‰ç«¯ï¼š**

```powershell
cd frontend
npm run dev      # å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
```

å‰ç«¯å°†åœ¨ http://localhost:5173 è¿è¡Œ

### ç¬¬äº”æ­¥ï¼šå¼€å§‹ä½¿ç”¨ï¼

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:5173
2. ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼š
   - ç”¨æˆ·å: `admin`
   - å¯†ç : `admin123`
3. ç‚¹å‡» "Upload FLAC Files" ä¸Šä¼ æ‚¨çš„æ— æŸéŸ³ä¹
4. ç‚¹å‡»åˆ—è¡¨ä¸­çš„ "Play" æŒ‰é’®æ’­æ”¾éŸ³ä¹
5. ä½¿ç”¨åº•éƒ¨æ’­æ”¾å™¨æ§åˆ¶æ’­æ”¾ï¼ˆæ’­æ”¾/æš‚åœã€éŸ³é‡ã€è¿›åº¦ç­‰ï¼‰

## é¡¹ç›®ç»“æ„è¯´æ˜

```
HoYoMusic/
â”œâ”€â”€ backend/                    # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/            # é…ç½®æ–‡ä»¶ï¼ˆæ•°æ®åº“ã€è®¤è¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ controllers/       # æ§åˆ¶å™¨ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶ï¼ˆè®¤è¯ã€ä¸Šä¼ ã€é”™è¯¯å¤„ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ routes/            # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ services/          # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ types/             # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ index.ts           # æœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ uploads/               # ä¸Šä¼ æ–‡ä»¶å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ tracks/            # éŸ³ä¹æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ covers/            # å°é¢å›¾ç‰‡
â”‚   â”œâ”€â”€ schema.sql             # æ•°æ®åº“æ¶æ„
â”‚   â”œâ”€â”€ .env                   # ç¯å¢ƒå˜é‡ï¼ˆï¿½ï¿½ï¿½é…ç½®ï¼‰
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ frontend/                   # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/        # React ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Player.tsx     # éŸ³ä¹æ’­æ”¾å™¨
â”‚   â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx  # è·¯ç”±ä¿æŠ¤
â”‚   â”‚   â”œâ”€â”€ pages/             # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.tsx      # ç™»å½•é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ Library.tsx    # éŸ³ä¹åº“é¡µé¢
â”‚   â”‚   â”œâ”€â”€ services/          # API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ store/             # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ types/             # TypeScript ç±»å‹
â”‚   â”‚   â”œâ”€â”€ App.tsx            # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ main.tsx           # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ .env                   # å‰ç«¯ç¯å¢ƒå˜é‡
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ PRD.md                      # äº§å“éœ€æ±‚æ–‡æ¡£
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜

```

## API æ¥å£æ–‡æ¡£

### è®¤è¯æ¥å£

**POST /api/auth/login**
- æè¿°: ç”¨æˆ·ç™»å½•
- è¯·æ±‚ä½“:
  ```json
  {
    "username": "admin",
    "password": "admin123"
  }
  ```
- å“åº”:
  ```json
  {
    "success": true,
    "data": {
      "token": "eyJhbGc...",
      "user": {
        "id": 1,
        "username": "admin"
      }
    }
  }
  ```

**GET /api/auth/me**
- æè¿°: è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- Headers: `Authorization: Bearer {token}`
- å“åº”: ç”¨æˆ·ä¿¡æ¯

### éŸ³ä¹æ¥å£

**POST /api/tracks/upload**
- æè¿°: ä¸Šä¼ éŸ³ä¹æ–‡ä»¶ï¼ˆæ”¯æŒæ‰¹é‡ï¼‰
- Headers: `Authorization: Bearer {token}`
- è¯·æ±‚: `multipart/form-data`
- å­—æ®µ: `tracks` (å¯å¤šä¸ªæ–‡ä»¶)
- å“åº”: ä¸Šä¼ æˆåŠŸçš„éŸ³ä¹åˆ—è¡¨

**GET /api/tracks?page=1&limit=20**
- æè¿°: è·å–éŸ³ä¹åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
- Headers: `Authorization: Bearer {token}`
- æŸ¥è¯¢å‚æ•°:
  - `page`: é¡µç ï¼ˆé»˜è®¤ 1ï¼‰
  - `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤ 20ï¼‰
- å“åº”: éŸ³ä¹åˆ—è¡¨å’Œåˆ†é¡µä¿¡æ¯

**GET /api/tracks/:id**
- æè¿°: è·å–å•ä¸ªéŸ³ä¹è¯¦æƒ…
- Headers: `Authorization: Bearer {token}`
- å“åº”: éŸ³ä¹è¯¦ç»†ä¿¡æ¯

**GET /api/tracks/:id/stream**
- æè¿°: æµå¼æ’­æ”¾éŸ³ä¹
- Headers: `Authorization: Bearer {token}`
- æ”¯æŒ: HTTP Range Requestsï¼ˆæ–­ç‚¹ç»­æ’­ï¼‰
- å“åº”: éŸ³é¢‘æµ

**GET /api/tracks/:id/download**
- æè¿°: ä¸‹è½½éŸ³ä¹æ–‡ä»¶
- Headers: `Authorization: Bearer {token}`
- å“åº”: FLAC æ–‡ä»¶ä¸‹è½½

## å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯**: `connection refused` æˆ– `password authentication failed`

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿ PostgreSQL æœåŠ¡æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ `backend/.env` ä¸­çš„æ•°æ®åº“å¯†ç æ˜¯å¦æ­£ç¡®
- ç¡®è®¤æ•°æ®åº“ `hoyomusic` å·²åˆ›å»º

### 2. ç«¯å£è¢«å ç”¨

**é”™è¯¯**: `Port 3000 is already in use`

**è§£å†³æ–¹æ¡ˆ**:
- ä¿®æ”¹ `backend/.env` ä¸­çš„ `PORT` å€¼
- æˆ–å…³é—­å ç”¨ç«¯å£çš„ç¨‹åº

### 3. å‰ç«¯æ— æ³•è¿æ¥åç«¯

**æ£€æŸ¥**:
- åç«¯æ˜¯å¦åœ¨è¿è¡Œï¼ˆhttp://localhost:3000/api/health åº”è¯¥è¿”å›æˆåŠŸï¼‰
- å‰ç«¯ `.env` ä¸­çš„ `VITE_API_URL` æ˜¯å¦æ­£ç¡®

### 4. ä¸Šä¼ å¤±è´¥

**å¯èƒ½åŸå› **:
- æ–‡ä»¶ä¸æ˜¯ FLAC æ ¼å¼
- æ–‡ä»¶è¿‡å¤§ï¼ˆé»˜è®¤æœ€å¤§ 500MBï¼‰
- ç£ç›˜ç©ºé—´ä¸è¶³

### 5. æ’­æ”¾æ— å£°éŸ³

**æ£€æŸ¥**:
- æµè§ˆå™¨æ˜¯å¦æ”¯æŒ FLAC æ ¼å¼ï¼ˆChrome 56+, Firefox 51+ï¿½ï¿½ï¿½
- éŸ³é‡è®¾ç½®æ˜¯å¦ä¸º 0
- æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

## å¼€å‘æŠ€å·§

### æŸ¥çœ‹åç«¯æ—¥å¿—

åç«¯ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºæ‰€æœ‰è¯·æ±‚å’Œé”™è¯¯ä¿¡æ¯ï¼Œæœ‰åŠ©äºè°ƒè¯•ã€‚

### æ•°æ®åº“ç®¡ç†

ä½¿ç”¨ pgAdmin æˆ–å‘½ä»¤è¡ŒæŸ¥çœ‹æ•°æ®ï¼š

```bash
psql -U postgres -d hoyomusic
SELECT * FROM tracks;
SELECT * FROM albums;
SELECT * FROM artists;
```

### æ¸…ç©ºæ•°æ®åº“

å¦‚éœ€é‡æ–°å¼€å§‹ï¼š

```bash
cd backend
# åˆ é™¤æ‰€æœ‰è¡¨
psql -U postgres -d hoyomusic
DROP SCHEMA public CASCADE;
CREATE SCHEMA public;
\q

# é‡æ–°åˆå§‹åŒ–
npm run setup
```

### ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 

ç›®å‰åªèƒ½é€šè¿‡æ•°æ®åº“ä¿®æ”¹ï¼š

```bash
psql -U postgres -d hoyomusic
UPDATE users SET password_hash = '$2b$10$æ–°çš„å“ˆå¸Œå€¼' WHERE username = 'admin';
```

æˆ–è€…ä½¿ç”¨ bcrypt åœ¨ Node.js ä¸­ç”Ÿæˆæ–°å¯†ç å“ˆå¸Œã€‚

## ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

æ ¹æ® PRD æ–‡æ¡£ Phase 2ï¼Œæ¥ä¸‹æ¥å¯ä»¥å®ç°ï¼š

1. **æ­Œè¯åŠŸèƒ½**
   - LRC æ ¼å¼æ­Œè¯ä¸Šä¼ 
   - æ­Œè¯åŒæ­¥æ»šåŠ¨æ˜¾ç¤º
   - æ­Œè¯åœ¨çº¿ç¼–è¾‘

2. **Credits ä¿¡æ¯**
   - è‡ªå®šä¹‰é”®å€¼å¯¹å­—æ®µ
   - æ˜¾ç¤ºåˆ¶ä½œäººå‘˜ä¿¡æ¯

3. **åˆ†ç±»ç³»ç»Ÿ**
   - è‡ªå®šä¹‰åˆ†ç±»ç»´åº¦
   - æ ‡ç­¾ç®¡ç†
   - æŒ‰åˆ†ç±»/æ ‡ç­¾æµè§ˆ

4. **æ’­æ”¾åˆ—è¡¨**
   - åˆ›å»ºè‡ªå®šä¹‰æ’­æ”¾åˆ—è¡¨
   - æ’­æ”¾åˆ—è¡¨ç®¡ç†

5. **æœç´¢åŠŸèƒ½**
   - æŒ‰æ ‡é¢˜ã€è‰ºæœ¯å®¶ã€ä¸“è¾‘æœç´¢
   - é«˜çº§ç­›é€‰

## æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. Node.js ç‰ˆæœ¬ >= 18
2. PostgreSQL ç‰ˆæœ¬ >= 14
3. æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…ï¼ˆbackend å’Œ frontend éƒ½è¿è¡Œè¿‡ `npm install`ï¼‰
4. ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
5. æ•°æ®åº“å·²åˆå§‹åŒ–ï¼ˆè¿è¡Œè¿‡ `npm run setup`ï¼‰

---

**HoYoMusic** - äº«å—é«˜å“è´¨éŸ³ä¹ï¼ğŸµ

