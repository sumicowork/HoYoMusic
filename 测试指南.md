# 🧪 权限修复测试指南

## 快速测试步骤

### 1️⃣ 测试播放队列持久化 ✅

**步骤**:
1. 打开浏览器访问 http://localhost:5173
2. 播放任意一首歌曲
3. 添加几首歌到播放队列（点击歌曲的播放按钮会添加到队列）
4. 打开播放队列面板（点击右下角播放器的队列图标）
5. 验证队列中有歌曲
6. **刷新页面** (F5)
7. ✅ 验证：队列中的歌曲仍然存在
8. **关闭浏览器**
9. 重新打开浏览器访问 http://localhost:5173
10. 打开播放队列面板
11. ✅ 验证：队列中的歌曲仍然存在

**查看持久化数据**:
- 打开浏览器开发者工具 (F12)
- 切换到 Application / 应用程序 标签
- 左侧菜单选择 Local Storage
- 找到 `hoyomusic-player-storage`
- 可以看到保存的队列数据

---

### 2️⃣ 测试权限修复 ✅

#### 测试 1: 主页没有播放列表入口
1. 访问主页 http://localhost:5173
2. ✅ 验证：顶部导航栏**没有**"我的播放列表"按钮
3. ✅ 验证：只有这些按钮：专辑、艺术家、标签、管理

#### 测试 2: 曲目详情页没有写操作按钮
1. 点击任意歌曲进入详情页
2. ✅ 验证：**没有**"添加到播放列表"按钮
3. ✅ 验证：**没有**"管理标签"按钮
4. ✅ 验证：只有 Play 和 Download 按钮

#### 测试 3: 标签页面是只读的
1. 点击主页的"标签"按钮
2. ✅ 验证：页面标题是"标签浏览"（不是"标签管理"）
3. ✅ 验证：**没有**"创建标签"按钮
4. ✅ 验证：每个标签卡片上**没有**"编辑"和"删除"按钮
5. ✅ 验证：点击标签可以查看该标签下的歌曲

#### 测试 4: 播放列表路由已删除
1. 手动访问 http://localhost:5173/playlists
2. ✅ 验证：会跳转回首页（404重定向）

#### 测试 5: API 权限保护（可选）
打开浏览器控制台，执行以下命令：

```javascript
// 测试创建标签（应该失败）
fetch('http://localhost:3000/api/tags', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ name: '测试标签' })
})
.then(r => r.json())
.then(console.log)
// ✅ 应该返回 401 Unauthorized
```

---

### 3️⃣ 测试正常功能未受影响 ✅

#### 浏览功能
- ✅ 可以浏览游戏
- ✅ 可以浏览专辑
- ✅ 可以浏览艺术家
- ✅ 可以浏览标签
- ✅ 可以查看曲目详情

#### 播放功能
- ✅ 可以播放歌曲
- ✅ 可以下载歌曲
- ✅ 可以查看歌词
- ✅ 可以查看 Credits
- ✅ 可以查看标签

#### 播放队列功能
- ✅ 可以添加歌曲到队列
- ✅ 可以从队列移除歌曲
- ✅ 可以清空队列
- ✅ 可以切换播放模式
- ✅ 队列会持久化保存

#### 管理后台
- ✅ 可以访问 /admin/login
- ✅ 登录后可以上传音乐
- ✅ 登录后可以编辑/删除曲目
- ✅ 登录后可以管理专辑

---

## 🐛 如果发现问题

### 播放队列没有持久化
**检查**:
1. 打开浏览器开发者工具
2. Console 标签查看是否有错误
3. Application 标签查看 Local Storage 中是否有数据

**可能原因**:
- 浏览器隐私模式（无痕模式）会禁用 localStorage
- 浏览器设置阻止了 localStorage

### 仍然能看到写操作按钮
**检查**:
1. 确认已经刷新页面（Ctrl+Shift+R 强制刷新）
2. 清除浏览器缓存
3. 检查是否在正确的环境（开发环境）

---

## ✅ 测试通过标准

全部以下项目应该通过：

- [ ] 主页没有"我的播放列表"按钮
- [ ] 曲目详情页没有"添加到播放列表"和"管理标签"按钮
- [ ] 标签页面只能浏览，不能创建/编辑/删除
- [ ] 访问 /playlists 会跳转首页
- [ ] 播放队列刷新后仍然存在
- [ ] 播放队列关闭浏览器后仍然存在
- [ ] 所有查看功能正常工作
- [ ] 播放功能正常工作
- [ ] 管理后台仍然可以访问

---

**测试完成后**: 请在权限修复完成报告中标记测试结果 ✅

