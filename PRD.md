# HoYoMusic - 产品需求文档 (PRD)

**文档版本**: v1.1  
**创建日期**: 2026-02-08  
**最后更新**: 2026-02-08  
**产品名称**: HoYoMusic  
**产品类型**: 个人无损音乐收藏与播放平台

---

## 1. 产品概述

### 1.1 产品定位
HoYoMusic 是一个专注于高品质音乐收藏与播放的个人在线平台，支持无损音乐格式（FLAC）的在线播放和下载。产品面向追求音质和视觉体验的音乐爱好者，提供简约而华丽的界面设计。

### 1.2 核心价值
- 支持 FLAC 无损音乐格式的在线播放和下载
- 展示完整的音乐元数据信息（专辑封面、歌手、歌词、专辑名、Credits等）
- 简约而华丽的用户界面设计
- 个人音乐库智能管理

### 1.3 目标用户
- 单用户系统（仅管理员本人使用）
- 音乐发烧友
- 追求高品质音乐体验的收藏者

---

## 2. 功能需求

### 2.1 用户系统

#### 2.1.1 用户管理
- **用户类型**: 单用户系统（仅管理员）
- **认证方式**: 登录认证（用户名 + 密码）
- **密码管理**: 仅支持后端/数据库层面修改密码，无前端修改功能
- **用户权限**: 全部管理权限（上传、编辑、删除、播放、下载）

#### 2.1.2 存储限制
- **空间限制**: 无限制
- **文件数量**: 无限制

### 2.2 音乐管理

#### 2.2.1 音乐上传
- **上传方式**: 用户自行上传
- **支持格式**: 仅支持 FLAC 格式（无损音频）
- **批量上传**: 支持多文件批量上传
- **上传限制**: 无单个文件大小限制
- **智能归组**: 批量上传时自动识别同一专辑的歌曲并归组（基于 FLAC 内嵌元数据中的专辑名）

#### 2.2.2 元数据处理
- **自动提取**: 上传时自动提取 FLAC 文件内嵌的元数据
  - 歌曲名称、艺术家、专辑名
  - 发行日期、音轨号
  - 采样率、位深度等音频信息
- **封面提取**: 自动提取 FLAC 内嵌的专辑封面
- **手动上传封面**: 支持手动上传封面图片（优先级高于内嵌封面）
- **元数据编辑**: 支持编辑所有音乐元数据

#### 2.2.3 歌词管理
- **歌词格式**: 仅支持 LRC 格式
- **歌词来源**: 手动上传 LRC 文件（不从 FLAC 内嵌提取）
- **歌词编辑**: 支持在线编辑歌词内容

#### 2.2.4 Credits 管理
- **字段配置**: 完全自由定义键值对形式
- **常见字段**: 作曲、作词、编曲、演唱、混音、母带等
- **无固定模板**: 用户可根据需要添加任意字段

#### 2.2.5 音乐组织
- **分类维度**: 支持多维度分类，维度可由用户自由配置
- **标签系统**: 支持自定义标签
- **专辑管理**: 
  - 单个专辑可包含多首歌曲
  - 支持专辑级别和单曲级别的展示
  - 区分专辑和单曲，单曲可独立存在也可包含在专辑中

### 2.3 音乐浏览

#### 2.3.1 浏览方式
- 按专辑浏览
- 按歌手浏览
- 按自定义分类维度浏览
- 按标签浏览
- 搜索功能

#### 2.3.2 信息展示
音乐详情页需展示以下信息：
- **专辑封面**: 高清展示
- **基本信息**:
  - 歌曲名称
  - 歌手/艺术家
  - 专辑名称
  - 发行日期
  - 时长
  - 音频格式信息（采样率、位深度等）
- **歌词**: 
  - 如有歌词则展示
  - 支持逐行滚动显示
  - 与播放进度同步
- **Credits**: 
  - 制作人员信息
  - 自由配置的键值对字段

### 2.4 音乐播放

#### 2.4.1 播放功能
- **播放格式**: FLAC 无损格式在线播放（保持无损品质）
- **播放控制**:
  - 播放/暂停
  - 上一曲/下一曲
  - 进度条拖动
  - 音量控制
- **播放模式**:
  - 顺序播放
  - 单曲循环
  - 列表循环
  - 随机播放
- **播放队列**:
  - 查看当前播放列表
  - 支持添加到队列
  - 支持队列管理（删除、排序）

#### 2.4.2 歌词显示
- 播放器界面显示歌词
- 逐行滚动，与播放进度同步
- 支持点击歌词跳转到对应时间点

### 2.5 音乐下载

#### 2.5.1 下载功能
- 支持单曲下载（FLAC格式）
- 支持专辑打包下载
- 下载时保留完整元数据


---

## 3. 非功能需求

### 3.1 性能要求
- **播放延迟**: FLAC 音频加载和播放响应时间 < 2秒
- **上传速度**: 充分利用用户带宽
- **页面加载**: 首屏加载时间 < 3秒
- **并发处理**: 单用户系统，无高并发需求

### 3.2 兼容性要求

#### 3.2.1 平台支持
- **PC端**: 
  - 需要全面支持（首要开发目标）
  - 响应式设计为桌面屏幕优化
- **移动端**: 
  - 后续版本适配（Phase 4）
  - 可根据时间情况延后或简化

#### 3.2.2 浏览器支持
- Chrome (最新版本)
- Firefox (最新版本)
- Safari (最新版本)
- Edge (最新版本)

#### 3.2.3 音频格式支持
- **输入格式**: FLAC（唯一支持的上传格式）
- **播放格式**: FLAC 无损播放（不进行转码压缩）
- **不支持格式转换**: 不支持从其他格式转换

### 3.3 安全要求
- 用户登录认证
- 文件上传安全校验
- 数据传输加密（HTTPS）- 建议通过 Nginx 反向代理处理 SSL
- 防止未授权访问

### 3.4 可用性要求
- 界面简洁直观
- 操作流程简单易懂
- 快捷键支持（播放控制）

### 3.5 数据备份
- **音乐文件**: 无需系统级备份（用户自行管理源文件）
- **数据库**: 需要定期备份
  - 建议使用 pg_dump 定时备份
  - 备份文件存储到独立位置

---

## 4. 设计要求

### 4.1 UI/UX设计原则
- **设计风格**: 简约但华丽
- **视觉特点**:
  - 现代化设计语言
  - 注重专辑封面的视觉呈现
  - 优雅的动画过渡效果
  - 高品质的视觉体验
  - 可考虑：毛玻璃效果、封面动态模糊背景等
- **色彩方案**: 
  - MVP 阶段使用单一主题（深色推荐）
  - 深色/浅色主题切换延迟到 Phase 3 实现
- **排版**: 清晰的信息层级，突出音乐内容

### 4.2 界面布局
- **首页**: 音乐库概览（最近添加、推荐等）
- **浏览页**: 按分类维度展示音乐列表
- **详情页**: 展示完整的音乐信息和播放器
- **播放器**: 
  - 持久化底部播放器（全局）
  - 可展开为完整播放界面
  - 显示封面、歌词、进度等

---

## 5. 技术方案

### 5.1 推荐技术栈

#### 5.1.1 前端技术栈
- **框架**: React + TypeScript
  - 生态成熟、组件化开发、类型安全
  - 适合复杂的音乐播放器交互
  
- **UI框架**: 
  - Ant Design（基础组件）
  - 自定义设计以实现"简约但华丽"的风格
  
- **音频播放**: 
  - **Howler.js** (推荐)
    - 支持多种音频格式包括FLAC
    - 提供完整的播放控制API
    - 跨浏览器兼容性好
  - 或使用 HTML5 Audio API + Web Audio API
  
- **歌词同步**: 
  - 自定义实现 LRC 格式歌词解析
  - 使用定时器同步滚动
  
- **状态管理**: Zustand
  - 轻量级、简洁的 API
  - 管理播放状态、播放列表、用户状态
  
- **路由**: React Router
  
- **HTTP客户端**: Axios

#### 5.1.2 后端技术栈
- **框架**: Node.js + Express
  - JavaScript全栈、高性能、生态丰富
  
- **数据库**: PostgreSQL
  - 强大的关系型数据库
  - 支持JSON字段（适合 Credits 等灵活结构）
  - 稳定可靠
  
- **文件存储**: 
  - 本地文件系统 + 数据库存储元数据
  - 可选：MinIO（开源对象存储，S3兼容，方便后期扩展）
  
- **音频元数据提取**: 
  - **music-metadata** (Node.js)
    - 自动提取 FLAC 文件的元数据和内嵌封面

#### 5.1.3 其他技术组件
- **身份认证**: JWT + Passport.js
  
- **文件上传**: 
  - Multer (Node.js)
  - 支持大文件分片上传
  
- **API设计**: RESTful API

- **HTTPS**: 
  - 推荐使用 **Nginx** 反向代理处理 SSL 证书
  - 配合 Let's Encrypt 免费证书
  - 简化后端配置，便于维护

### 5.2 部署方案

#### 5.2.1 部署环境
- **目标环境**: 云服务器
- **推荐配置**:
  - 2核 4G 内存起步
  - SSD 存储（根据音乐库规模）
  - 带宽根据外网访问需求选择

#### 5.2.2 系统架构
```
用户浏览器
    ↓ (HTTPS)
Nginx (反向代理 + SSL)
    ↓ (HTTP)
后端服务 (Node.js/Express)
    ↓
PostgreSQL 数据库
    ↓
文件存储 (本地/MinIO)
```

#### 5.2.3 关键技术考虑

**FLAC无损播放**:
- 现代浏览器原生支持FLAC播放（Chrome 56+, Firefox 51+, Edge 79+）
- 使用 HTML5 Audio API 或 Howler.js 直接播放
- 后端直接提供FLAC文件流，无需转码
- 使用 HTTP Range Requests 支持音频流式加载和拖动

**大文件处理**:
- 前端：分片上传
- 后端：流式处理，避免全部加载到内存
- 支持断点续传

**批量上传智能归组**:
- 上传时使用 music-metadata 提取元数据
- 根据专辑名字段自动识别同一专辑
- 提供预览界面让用户确认归组结果

**性能优化**:
- 专辑封面缩略图生成（多尺寸）
- CDN加速静态资源（可选）
- 前端懒加载和虚拟滚动（大量音乐列表）
- 音频文件流式传输

### 5.3 数据模型设计

#### 主要实体:
- **User** (用户) - 单用户
- **Album** (专辑)
- **Track** (音乐曲目)
- **Artist** (歌手/艺术家)
- **Playlist** (播放列表)
- **Lyric** (歌词)
- **Credit** (制作人员信息) - 键值对结构
- **Category** (自定义分类维度)
- **Tag** (标签)

---

## 6. 开发阶段规划

### 6.1 Phase 1: MVP (最小可行产品)
**目标**: 实现核心播放功能

**功能范围**:
- 用户登录认证
- FLAC文件上传（支持批量）
- 自动提取元数据和内嵌封面
- 基础元数据展示（专辑封面、歌手、专辑名、歌曲名）
- 无损音频播放（播放/暂停、进度控制、音量控制）
- 简单的音乐列表浏览（列表形式）
- 单曲下载

**时间估计**: 4-6周

### 6.2 Phase 2: 完整功能
**功能范围**:
- 批量上传智能专辑归组
- 完整的元数据编辑功能
- 手动上传封面（覆盖内嵌封面）
- 歌词上传（LRC）与同步滚动显示
- Credits信息展示与配置（自由键值对）
- 多维度分类系统
- 按专辑/歌手/标签浏览
- 播放队列管理
- 专辑批量下载
- 搜索功能

**时间估计**: 4-6周

### 6.3 Phase 3: 优化与增强
**功能范围**:
- UI/UX优化打磨（实现"简约但华丽"的设计）
- 深色/浅色主题切换
- 性能优化
- 快捷键支持
- 高级搜索和过滤
- 批量操作

**时间估计**: 3-4周

### 6.4 Phase 4: 移动端适配（可选/延后）
**功能范围**:
- 响应式设计优化
- 移动端触控交互
- 移动端播放器界面
- 移动端性能优化

**时间估计**: 3-4周  
**优先级**: 低，可根据实际情况延后或简化

---

## 7. 暂不考虑的功能

以下功能在当前版本暂不实现，可在后续版本中考虑：

### 7.1 社交功能
- 用户评论
- 音乐分享
- 社交网络集成

### 7.2 多用户系统
- 多用户注册
- 用户权限分级
- 公开/私密音乐库
- 前端密码修改

### 7.3 音乐推荐
- 基于算法的音乐推荐
- 个性化推荐

### 7.4 格式转换
- 音频格式转换
- 音质降级播放（节省带宽）

### 7.5 在线编辑
- 在线音频编辑
- 音频剪辑

### 7.6 音乐分析
- 音乐波形可视化
- 音频分析工具

### 7.7 云同步
- 跨设备同步播放进度
- 播放历史记录

### 7.8 其他歌词格式
- SRT、纯文本等格式
- FLAC 内嵌歌词提取

---

## 8. 技术方案总结

### 8.1 最终技术栈

```
┌─────────────────────────────────────────────────────────┐
│                        前端                              │
│  React + TypeScript + Howler.js + Zustand + Ant Design │
└─────────────────────────────────────────────────────────┘
                           ↓ HTTPS
┌─────────────────────────────────────────────────────────┐
│                    Nginx 反向代理                        │
│              (SSL 证书 + Let's Encrypt)                  │
└─────────────────────────────────────────────────────────┘
                           ↓ HTTP
┌─────────────────────────────────────────────────────────┐
│                        后端                              │
│           Node.js + Express + music-metadata            │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│                       数据层                             │
│     PostgreSQL (元数据) + 本地文件系统 (FLAC文件)        │
└─────────────────────────────────────────────────────────┘
```

### 8.2 方案优势
- ✅ JavaScript/TypeScript 全栈，技术栈统一
- ✅ FLAC 原生支持，无需转码，保证无损品质
- ✅ 成熟的生态系统和丰富的第三方库
- ✅ 良好的性能表现
- ✅ 便于后期扩展（移动端、多用户等）
- ✅ 开发效率高
- ✅ Nginx 处理 SSL，简化后端逻辑

### 8.3 关键技术验证点
1. **FLAC浏览器兼容性**: ✅ 主流浏览器已支持
2. **大文件上传**: ✅ 分片上传技术成熟
3. **无损播放性能**: ✅ HTML5 Audio API 性能充足
4. **歌词同步**: ✅ LRC 格式 + 定时器实现
5. **元数据提取**: ✅ music-metadata 库成熟稳定

---

## 9. 成功指标

### 9.1 技术指标
- FLAC文件上传成功率 > 99%
- 播放器响应时间 < 2秒
- 页面加载时间 < 3秒
- 系统稳定性 > 99.5%

### 9.2 用户体验指标
- 播放流畅度（无卡顿）
- 界面操作流畅性
- 信息展示完整性

---

## 10. 风险与挑战

### 10.1 技术风险
- **大文件处理**: FLAC文件体积较大，需要优化上传和流式传输
- **浏览器限制**: 部分旧版浏览器可能不支持FLAC
- **存储成本**: 无损音频占用空间大

### 10.2 解决方案
- 实现分片上传和断点续传
- 明确浏览器支持范围，引导用户使用现代浏览器
- 提供存储空间监控和管理功能

---

## 11. 附录

### 11.1 相关技术文档
- [Howler.js Documentation](https://howlerjs.com/)
- [Web Audio API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API)
- [music-metadata npm](https://www.npmjs.com/package/music-metadata)
- [LRC歌词格式规范](https://en.wikipedia.org/wiki/LRC_(file_format))
- [Nginx SSL 配置指南](https://nginx.org/en/docs/http/configuring_https_servers.html)
- [Let's Encrypt](https://letsencrypt.org/)

### 11.2 参考项目
- Apple Music (界面设计参考)
- Spotify Web Player (播放器交互参考)
- Tidal (高品质音乐展示参考)

### 11.3 术语表
- **FLAC**: Free Lossless Audio Codec，无损音频压缩格式
- **Credits**: 音乐制作人员信息
- **LRC**: 歌词文本格式，支持时间戳同步
- **元数据**: 描述音乐文件的信息（标题、艺术家、专辑等）

---

**文档结束**

---

## 变更记录

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|----------|--------|
| v1.0 | 2026-02-08 | 初始版本创建 | - |
| v1.1 | 2026-02-08 | 根据需求讨论优化：明确单用户密码管理方式、添加批量上传智能归组功能、明确封面来源优先级、明确歌词仅支持 LRC 手动上传、Credits 改为自由键值对、主题切换延迟到 Phase 3、添加 Nginx SSL 方案、添加数据库备份需求、调整移动端优先级 | - |

